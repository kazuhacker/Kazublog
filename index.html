<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
  /* General Styles */
  * {box-sizing: border-box;}
  body {margin:0;font: Arial, sans-serif;background:#f2f2f2;}
  a {text-decoration:none;color:inherit;}
  
  /* Navbar */
  .navbar {display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#007bff;color:#fff;position:sticky;top:0;z-index:100;}
  .navbar .title {font-size:20px;font-weight:bold;}
  .navbar .profile {cursor:pointer;}
  
  /* Sidebar */
  .sidebar {position:fixed;left:0;top:50px;width:220px;background:#fff;height:100%;box-shadow:2px 0 5px rgba(0,0,0,0.1);transition:0.3s;overflow:auto;}
  .sidebar.collapsed {width:60px;}
  .sidebar ul {list-style:none;padding:0;margin:0;}
  .sidebar li {padding:15px 20px;cursor:pointer;display:flex;align-items:center;}
  .sidebar li:hover {background:#f0f0f0;}
  
  /* Main Content */
  .main {margin-left:220px;padding:20px;transition:0.3s;}
  .main.collapsed {margin-left:60px;}
  
  /* Search & Filter */
  .controls {display:flex;justify-content:space-between;margin-bottom:15px;flex-wrap:wrap;gap:10px;}
  .controls input, .controls select, .controls button {padding:8px;border-radius:6px;border:1px solid #ccc;}
  .controls button {background:#007bff;color:#fff;border:none;cursor:pointer;}
  .controls button:hover {background:#0056b3;}
  
  /* Table */
  table {width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,0.05);}
  th, td {padding:10px;text-align:left;border-bottom:1px solid #eee;}
  th {background:#f7f7f7;}
  tr:hover {background:#f1f1f1;}
  .thumbnail {width:40px;height:40px;border-radius:50%;object-fit:cover;}
  .badge {padding:4px 8px;border-radius:12px;color:#fff;font-size:12px;}
  .male {background:#007bff;}
  .female {background:#ff4081;}
  
  /* Actions */
  .actions button {margin-right:5px;padding:5px 8px;border-radius:6px;border:none;cursor:pointer;font-size:12px;}
  .edit {background:#28a745;color:#fff;}
  .delete {background:#dc3545;color:#fff;}
  .view {background:#17a2b8;color:#fff;}
  .download {background:#ffc107;color:#fff;}
  
  /* Modal */
  .modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;}
  .modal-content {background:#fff;padding:20px;border-radius:12px;max-width:600px;width:90%;max-height:90%;overflow:auto;position:relative;}
  .modal-content h3 {margin-top:0;}
  .modal-content .images {display:flex;gap:10px;margin-bottom:10px;}
  .modal-content img {width:100px;height:100px;object-fit:cover;border-radius:8px;}
  .modal-content .modal-actions {margin-top:15px;text-align:right;}
  .close-modal {position:absolute;top:10px;right:15px;font-size:20px;font-weight:bold;cursor:pointer;}
  
  /* Toast */
  #toast {position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px 20px;border-radius:8px;display:none;}
  
  /* Responsive */
  @media(max-width:768px){
    .sidebar{position:relative;width:100%;height:auto;}
    .main{margin-left:0;}
  }
</style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <div class="title">Admin Dashboard</div>
  <div class="profile">Profile / Logout</div>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <ul>
    <li>Dashboard</li>
    <li>All Records</li>
    <li>Filters</li>
    <li>Export/Download</li>
    <li>Settings</li>
  </ul>
</div>

<!-- Main Content -->
<div class="main" id="main">
  <div class="controls">
    <input type="text" id="searchName" placeholder="Search by Name">
    <select id="filterGender">
      <option value="all">All</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
    <button id="downloadAll">Download All PDF</button>
  </div>
  
  <table id="recordsTable">
    <thead>
      <tr>
        <th>Photo</th>
        <th>Name</th>
        <th>Gender</th>
        <th>Age</th>
        <th>Date Submitted</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Records dynamically inserted here -->
    </tbody>
  </table>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">&times;</span>
    <h3 id="modalName"></h3>
    <p><strong>Gender:</strong> <span id="modalGender"></span></p>
    <p><strong>Age:</strong> <span id="modalAge"></span></p>
    <p><strong>Citizenship Number:</strong> <span id="modalCNum"></span></p>
    <div class="images">
      <img id="modalPassport" alt="Passport">
      <img id="modalCFront" alt="Citizenship Front">
      <img id="modalCBack" alt="Citizenship Back">
    </div>
    <div class="modal-actions">
      <button class="edit" id="editBtn">Edit</button>
      <button class="delete" id="deleteBtn">Delete</button>
      <button class="download" id="downloadBtn">Download PDF</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  // Firebase Config - replace with your credentials
  const firebaseConfig = {
  apiKey: "AIzaSyA05yiB3GPh0e8VjiWacd1D1mXCFYNFvjs",
  authDomain: "earning-58441.firebaseapp.com",
  databaseURL: "https://earning-58441-default-rtdb.firebaseio.com",
  projectId: "earning-58441",
  storageBucket: "earning-58441.firebasestorage.app",
  messagingSenderId: "771237826936",
  appId: "1:771237826936:web:2489c2b4db2640638a388d",
  measurementId: "G-TRV6N5E1NY"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const recordsRef = db.ref('forms');

  const tbody = document.querySelector('#recordsTable tbody');
  const searchInput = document.getElementById('searchName');
  const filterGender = document.getElementById('filterGender');
  const toast = document.getElementById('toast');

  let allRecords = [];

  // Toast function
  function showToast(msg){
    toast.innerText = msg;
    toast.style.display = 'block';
    setTimeout(()=>{toast.style.display='none';},3000);
  }

  // Render Table
  function renderTable(){
    const searchVal = searchInput.value.toLowerCase();
    const genderVal = filterGender.value;
    tbody.innerHTML = '';
    allRecords.filter(r=>{
      return (r.name.toLowerCase().includes(searchVal)) && 
             (genderVal==='all' || r.gender===genderVal);
    }).forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><img src="${r.passportPhoto}" class="thumbnail"></td>
        <td><a href="#" class="viewLink" data-id="${r.id}">${r.name}</a></td>
        <td><span class="badge ${r.gender}">${r.gender}</span></td>
        <td>${r.age}</td>
        <td>${new Date(r.createdAt).toLocaleDateString()}</td>
        <td class="actions">
          <button class="view" data-id="${r.id}">View</button>
          <button class="edit" data-id="${r.id}">Edit</button>
          <button class="delete" data-id="${r.id}">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Fetch Data
  recordsRef.on('value', snapshot=>{
    allRecords=[];
    snapshot.forEach(child=>{
      allRecords.push({...child.val(), id: child.key});
    });
    renderTable();
  });

  // Search & Filter
  searchInput.addEventListener('input', renderTable);
  filterGender.addEventListener('change', renderTable);

  // Modal Logic
  const modal = document.getElementById('modal');
  const closeModal = document.getElementById('closeModal');
  closeModal.onclick = ()=> modal.style.display='none';

  tbody.addEventListener('click', (e)=>{
    if(e.target.classList.contains('viewLink') || e.target.classList.contains('view')){
      const id = e.target.dataset.id;
      openModal(id);
    }
    if(e.target.classList.contains('edit')){
      const id = e.target.dataset.id;
      editRecord(id);
    }
    if(e.target.classList.contains('delete')){
      const id = e.target.dataset.id;
      deleteRecord(id);
    }
  });

  function openModal(id){
    const record = allRecords.find(r=>r.id===id);
    if(!record) return;
    document.getElementById('modalName').innerText = record.name;
    document.getElementById('modalGender').innerText = record.gender;
    document.getElementById('modalAge').innerText = record.age;
    document.getElementById('modalCNum').innerText = record.citizenshipNumber;
    document.getElementById('modalPassport').src = record.passportPhoto;
    document.getElementById('modalCFront').src = record.citizenshipFront;
    document.getElementById('modalCBack').src = record.citizenshipBack;
    modal.style.display='flex';
  }

  function editRecord(id){
    const record = allRecords.find(r=>r.id===id);
    if(!record) return;
    const newName = prompt("Enter new name", record.name);
    if(newName) {
      recordsRef.child(id).update({name:newName}, err=>{
        if(err) showToast('Error updating!');
        else showToast('Updated successfully!');
      });
    }
  }

  function deleteRecord(id){
    if(confirm("Are you sure to delete this record?")){
      recordsRef.child(id).remove(err=>{
        if(err) showToast('Error deleting!');
        else showToast('Deleted successfully!');
      });
    }
  }

  // Download single PDF
  document.getElementById('downloadBtn').onclick = ()=>{
    const name = document.getElementById('modalName').innerText;
    const doc = new jspdf.jsPDF();
    doc.text(`Name: ${name}`,10,10);
    doc.save(`${name}.pdf`);
  }

  // Download all PDF
  document.getElementById('downloadAll').onclick = ()=>{
    const doc = new jspdf.jsPDF();
    let y = 10;
    allRecords.forEach(r=>{
      doc.text(`Name: ${r.name}`,10,y);
      y+=10;
      doc.text(`Gender: ${r.gender}`,10,y);
      y+=10;
      doc.text(`Age: ${r.age}`,10,y);
      y+=20;
    });
    doc.save(`All_Records.pdf`);
  }
</script>
</body>
</html>